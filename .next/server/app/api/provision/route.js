"use strict";(()=>{var e={};e.id=303,e.ids=[303],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},6543:(e,r,t)=>{t.r(r),t.d(r,{originalPathname:()=>g,patchFetch:()=>h,requestAsyncStorage:()=>u,routeModule:()=>l,serverHooks:()=>d,staticGenerationAsyncStorage:()=>c});var o={};t.r(o),t.d(o,{POST:()=>p});var s=t(9303),a=t(8716),n=t(670);let i="https://api.hetzner.cloud/v1";async function p(e){let r=new TextEncoder;return new Response(new ReadableStream({async start(t){let o=e=>{t.enqueue(r.encode(JSON.stringify(e)+"\n"))};try{let{apiToken:r,sshKey:s,serverName:a="openclaw"}=await e.json();if(!r){o({error:"API token is required"}),t.close();return}let n={Authorization:`Bearer ${r}`,"Content-Type":"application/json"};if(o({progress:"\uD83D\uDD11 Verifying API token..."}),!(await fetch(`${i}/servers`,{headers:n})).ok){o({error:"Invalid API token. Please check and try again."}),t.close();return}o({progress:"✓ API token valid"});let p=null;if(s&&s.startsWith("ssh-")){o({progress:"\uD83D\uDD10 Uploading SSH key..."});let e=`openclaw-wizard-${Date.now()}`,r=await fetch(`${i}/ssh_keys`,{method:"POST",headers:n,body:JSON.stringify({name:e,public_key:s.trim()})});if(r.ok)p=(await r.json()).ssh_key.id,o({progress:"✓ SSH key uploaded"});else{let e=await fetch(`${i}/ssh_keys`,{headers:n}),r=await e.json(),t=s.trim().split(" ").slice(0,2).join(" "),a=r.ssh_keys?.find(e=>e.public_key.startsWith(t));a&&(p=a.id,o({progress:"✓ Using existing SSH key"}))}}let l=`#cloud-config
runcmd:
  - curl -fsSL https://raw.githubusercontent.com/telegraphic-dev/openclaw-hetzner-bootstrap/main/bootstrap.sh | bash > /var/log/openclaw-bootstrap.log 2>&1
  - echo "BOOTSTRAP_COMPLETE" >> /var/log/openclaw-bootstrap.log`;o({progress:"\uD83D\uDDA5️ Creating server..."});let u={name:a,server_type:"cax11",location:"fsn1",image:"ubuntu-24.04",user_data:l};p&&(u.ssh_keys=[p]);let c=await fetch(`${i}/servers`,{method:"POST",headers:n,body:JSON.stringify(u)});if(!c.ok){let e=await c.json();o({error:`Failed to create server: ${e.error?.message||"Unknown error"}`}),t.close();return}let d=await c.json(),g=d.server.id,h=d.server.public_net.ipv4.ip,w=d.root_password;o({progress:`✓ Server created (IP: ${h})`}),o({progress:"⏳ Waiting for server to boot..."});for(let e=0;e<60;e++){await new Promise(e=>setTimeout(e,3e3));let e=await fetch(`${i}/servers/${g}`,{headers:n}),r=await e.json();if("running"===r.server.status){o({progress:"✓ Server is running"});break}}o({progress:"\uD83D\uDD27 Installing OpenClaw (this takes 2-3 minutes)..."}),await new Promise(e=>setTimeout(e,12e4)),o({progress:"✓ Installation complete!"});let m=Array.from(crypto.getRandomValues(new Uint8Array(32))).map(e=>e.toString(16).padStart(2,"0")).join("");o({done:!0,server:{ip:h,name:a,token:m,rootPassword:w||null}})}catch(e){o({error:e instanceof Error?e.message:"Unknown error occurred"})}t.close()}}),{headers:{"Content-Type":"text/plain; charset=utf-8","Transfer-Encoding":"chunked"}})}let l=new s.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/provision/route",pathname:"/api/provision",filename:"route",bundlePath:"app/api/provision/route"},resolvedPagePath:"/tmp/openclaw-wizard/app/api/provision/route.ts",nextConfigOutput:"standalone",userland:o}),{requestAsyncStorage:u,staticGenerationAsyncStorage:c,serverHooks:d}=l,g="/api/provision/route";function h(){return(0,n.patchFetch)({serverHooks:d,staticGenerationAsyncStorage:c})}},9303:(e,r,t)=>{e.exports=t(517)}};var r=require("../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),o=r.X(0,[948],()=>t(6543));module.exports=o})();