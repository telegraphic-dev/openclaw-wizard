"use strict";(()=>{var e={};e.id=303,e.ids=[303],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},6543:(e,r,t)=>{t.r(r),t.d(r,{originalPathname:()=>g,patchFetch:()=>v,requestAsyncStorage:()=>u,routeModule:()=>p,serverHooks:()=>d,staticGenerationAsyncStorage:()=>c});var s={};t.r(s),t.d(s,{POST:()=>l});var o=t(9303),n=t(8716),i=t(670);let a="https://api.hetzner.cloud/v1";async function l(e){let r=new TextEncoder;return new Response(new ReadableStream({async start(t){let s=e=>{t.enqueue(r.encode(JSON.stringify(e)+"\n"))};try{let{apiToken:r,sshKey:o,serverName:n="openclaw",location:i="fsn1",serverType:l="cax11"}=await e.json();if(!r){s({error:"API token is required"}),t.close();return}let p={Authorization:`Bearer ${r}`,"Content-Type":"application/json"};s({progress:"\uD83D\uDD11 Verifying API token..."});let u=await fetch(`${a}/servers`,{headers:p});if(!u.ok){s({error:"Invalid API token. Please check and try again."}),t.close();return}let c=await u.json(),d=c.servers?.find(e=>e.name===n);if(d){s({progress:`✓ Found existing server "${n}"`});let e=d.id,r=d.public_net?.ipv4?.ip;if(!r){s({error:"Existing server has no IP. Please delete it in Hetzner Console and try again."}),t.close();return}if("running"!==d.status){s({progress:`⏳ Server is ${d.status}, waiting for it to be ready...`});for(let r=0;r<60;r++){await new Promise(e=>setTimeout(e,3e3));let o=await fetch(`${a}/servers/${e}`,{headers:p}),n=await o.json();if("running"===n.server.status){s({progress:"✓ Server is running"});break}if(59===r){s({error:"Server taking too long to start. Please check Hetzner Console."}),t.close();return}}}else s({progress:"✓ Server is running"});s({progress:"✓ Server is already set up!"}),s({progress:"Showing connection details..."}),s({done:!0,server:{ip:r,name:n,token:"(check server - see instructions below)",rootPassword:null,isExisting:!0,serverId:e}}),t.close();return}s({progress:"✓ API token valid"});let g=null;if(o&&o.startsWith("ssh-")){s({progress:"\uD83D\uDD10 Uploading SSH key..."});let e=`openclaw-wizard-${Date.now()}`,r=await fetch(`${a}/ssh_keys`,{method:"POST",headers:p,body:JSON.stringify({name:e,public_key:o.trim()})});if(r.ok)g=(await r.json()).ssh_key.id,s({progress:"✓ SSH key uploaded"});else{let e=await fetch(`${a}/ssh_keys`,{headers:p}),r=await e.json(),t=o.trim().split(" ").slice(0,2).join(" "),n=r.ssh_keys?.find(e=>e.public_key.startsWith(t));n&&(g=n.id,s({progress:"✓ Using existing SSH key"}))}}let v=`#cloud-config
runcmd:
  - curl -fsSL https://raw.githubusercontent.com/telegraphic-dev/openclaw-hetzner-bootstrap/main/bootstrap.sh | bash > /var/log/openclaw-bootstrap.log 2>&1
  - echo "BOOTSTRAP_COMPLETE" >> /var/log/openclaw-bootstrap.log`;s({progress:"\uD83D\uDDA5️ Creating server..."});let h=[i,...["fsn1","nbg1","hel1","ash","hil","sin"].filter(e=>e!==i)],f=null,w=null,m="";for(let e of h){let r={name:n,server_type:l,location:e,image:"ubuntu-24.04",user_data:v};if(g&&(r.ssh_keys=[g]),(f=await fetch(`${a}/servers`,{method:"POST",headers:p,body:JSON.stringify(r)})).ok){w=await f.json(),m=e;break}let o=await f.json();if(o.error?.message?.includes("location")||o.error?.code==="unavailable"){s({progress:`⚠️ Location ${e} unavailable, trying next...`});continue}s({error:`Failed to create server: ${o.error?.message||"Unknown error"}`}),t.close();return}if(!w){s({error:"Failed to create server: No available locations. Please check your Hetzner account settings."}),t.close();return}let k=w.server.id,y=w.server.public_net.ipv4.ip,S=w.root_password;s({progress:`✓ Server created in ${m} (IP: ${y})`}),s({progress:"⏳ Waiting for server to boot..."});for(let e=0;e<60;e++){await new Promise(e=>setTimeout(e,3e3));let e=await fetch(`${a}/servers/${k}`,{headers:p}),r=await e.json();if("running"===r.server.status){s({progress:"✓ Server is running"});break}}s({progress:"\uD83D\uDD27 Installing OpenClaw (this takes 2-3 minutes)..."}),await new Promise(e=>setTimeout(e,12e4)),s({progress:"✓ Installation complete!"});let b=Array.from(crypto.getRandomValues(new Uint8Array(32))).map(e=>e.toString(16).padStart(2,"0")).join("");s({done:!0,server:{ip:y,name:n,token:b,rootPassword:S||null,serverId:k}})}catch(e){s({error:e instanceof Error?e.message:"Unknown error occurred"})}t.close()}}),{headers:{"Content-Type":"text/plain; charset=utf-8","Transfer-Encoding":"chunked"}})}let p=new o.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/provision/route",pathname:"/api/provision",filename:"route",bundlePath:"app/api/provision/route"},resolvedPagePath:"/tmp/openclaw-wizard/app/api/provision/route.ts",nextConfigOutput:"standalone",userland:s}),{requestAsyncStorage:u,staticGenerationAsyncStorage:c,serverHooks:d}=p,g="/api/provision/route";function v(){return(0,i.patchFetch)({serverHooks:d,staticGenerationAsyncStorage:c})}},9303:(e,r,t)=>{e.exports=t(517)}};var r=require("../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[948],()=>t(6543));module.exports=s})();